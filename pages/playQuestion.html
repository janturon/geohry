<script>
/*
INPUT
	STATE: G.questions, G.questionsImgs
	LS: G.nextLoc (order of current question), G.hintShown (1=hint of the question was shown)
*/
    LS.get("G", "questions", []);
    LS.get("G", "questionsImgs", []);
	LS.get("G", "nextLoc", 0);
	LS.set("G", "saved", G.nextLoc);
	LS.set("G", "lat", GPS.lat);
	LS.set("G", "lng", GPS.lng);

	var question = G.questions.find(i => i.ordnung == G.nextLoc);
	if(!question) {
		let order = G.nextLoc || '??';
		message.title = "Modrá smrt!";
		message.text = "Hra se pokusila načíst stanoviště s pořadovým číslem "+order+", chybí nám ale data. Hru bude nutné na tomto místě ukončit :-( Toto by vůbec nemělo nastat. Napiš autorovi, jakmile se to opraví, dáme ti vědět.";
		message.clear = true;
	}

	var gpswatch = _ => _;
	main.style.minHeight = "100vh";
</script>


<h2 id="h2game"></h2>

<script>
// název stanoviště
id("h2game");
h2game.innerHTML = question.name;
</script>


<div id="gameImg" style="display: none; width: 100%; height: 480px;"></div>

<script>
// obrázek stanoviště
id("gameImg");
if (G.questionsImgs.contains2(question.uniqid)) {
	gameImg.style.background = `center/cover url('games/${G.game.url}/${question.uniqid}.jpg')`;
	gameImg.style.display = "block";
    h2game.style.cssText = "position: absolute; margin: 1em";
}
</script>


<div id="gameQuestion"></div>

<script>
    // otázka stanoviště
    id("gameQuestion");
    gameQuestion.innerHTML = question.question;
</script>


<div id="gameForm"></div>

<script>
    // formulář stanoviště
	id("gameForm");
	setContent(`qForm/${question.type}`, {answer: question.answer}, gameForm);
</script>


<button id="btnAnswer" onclick="message.status ? answerOK() : answerKO()">Odpověz</button>
<div id="gameAnswer"></div>
<div id="gameDialogue"></div>
<button id="btnNext" style="display: none"></button>

<script>
    // tlačítko odpověz, odpověď správně/špatně, nápověda/text po otázce
    id(["btnAnswer", "gameAnswer", "gameDialogue"]);

	LS.get("G", "hintShown", 0);
    LS.get("STATE", "answers", {});

    function answerKO() {
		gameAnswer.innerHTML = `<span class="err">${Texts.no}</span>`;
		gameDialogue.innerHTML = G.hintShown ? question.after : question.hint;
    	STATE.answers[question.uniqid] = G.hintShown ? 0 : 1;
		LS.set("STATE", "answers", STATE.answers);
        if(G.hintShown) return leaveQuestion();
		LS.set("G", "hintShown", 1);
	}

	function answerOK() {
		gameAnswer.innerHTML = `<span class="ok">${Texts.yes}</span>`;
		gameDialogue.innerHTML = question.after;
		STATE.answers[question.uniqid] = G.hintShown ? 1 : 2;
		LS.set("STATE", "answers", STATE.answers);
        leaveQuestion();
	}

    function leaveQuestion() {
		LS.set("G", "hintShown", 0);
		LS.set("G", "nextLoc", G.nextLoc + 1);
		btnAnswer.style.display = "none";
		gameDialogue.innerHTML = question.after || G.nextLoc != G.questions.length && Texts.next;
		btnNext.innerHTML = G.nextLoc > G.questions.length ? 'Konec' : 'Dál';
        var tgt = G.nextLoc > G.questions.length ? "playResults" : "playGame"; // TODO: hvězdicová topologie
		btnNext.style.display = "inline-block";
    }
</script>
