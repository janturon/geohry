<script>
/*
	STATE: game, gameImgs
*/
var gameData;

var gpswatch = pos => {
	if(!game) return;
	var d = Play.distance(game, { lat: pos.coords.latitude, lng: pos.coords.longitude});
	d = d*1000 - game.radius;
	if(d<=0) distInfo.innerHTML = "Jsi na místě zahájení hry.";
	else if(d>5000) distInfo.innerHTML = "Od místa zahájení jsi daleko "+(Math.round(d/100)/10)+" km.";
	else distInfo.innerHTML = "Od místa zahájení jsi daleko "+(~~d)+" m.";
}
</script>

<h2 id="h2game"></h2>
<div id="gameImg" style="display: none; width: 100%; height: 480px; background: 50% 50%/cover no-repeat;"></div>
<div id="gameWelcome"></div>
<hr>
<div>
	<span id="mapInfo"></span>
	<span id="distInfo"></span>
	<span id="reqInfo"></span>
</div>
<button onclick="playIt()">Jdu do toho!</button>
<button onclick="leave()">Možná jindy.</button>

<div id="popup">
<div>
	<div id="popupin"></div>
	<button onclick="this.parentNode.parentNode.style.display='none'">No dobře</button>
</div>
</div>

<script>
id(["mapInfo","distInfo","reqInfo","h2game","gameImg","gameWelcome","popup"]);
if(!gameImgs.contains2("map")) mapInfo.innerHTML = "Hra nemá vlastní mapu a není možné ji hrát offline.";
else mapInfo.innerHTML = "Hra má vlastní mapu a je možné ji hrát offline.";

if(gameImgs.contains2("intro")) {
	gameImg.style.backgroundImage = `url('games/${game.url}/intro.jpg')`;
	gameImg.style.display = "block";
}

h2game.innerHTML = game.name;
gameWelcome.innerHTML = game.welcome;
if(game.personal && game.reason) {
	reqInfo.innerHTML = `Než začneš hrát, autor hry by chtěl o tobě vědět tyto údaje: <b>${game.personal}</b>. Proč? ${game.reason}`;
	reqInfo.innerHTML+= `<br><input oninput="localStorage.setItem('personal',this.value)" placeholder="Tvé údaje...">`;
}

function playIt() {
	if(game.personal && game.reason && !localStorage.getItem('personal')) {
		var container = popup.querySelector("div#popupin");
		popup.style.display = "flex";
		container.innerHTML = "Autor si přál nějaké tvé údaje. Tak mu vyhov, ať nebrečí.";
		return;
	}
	LS.set("G", "introduced", 1);
	setContent("playGame");
}

function leave() {
	["game", "questions"].forEach(i => localStorage.removeItem(i));
	LS.clear("G");
	setContent("homeUser");
}
</script>