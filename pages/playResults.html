<script>
    // vynucení připojení k internetu
    if(!navigator.onLine) {
        setContent("dialog", {
            title: "Výsledky",
            text: "Hra je u konce. Pro zobrazení výsledků se připoj k internetu a klikni na OK.",
            target: "playResults"
        });
        STATE.abort = true;
    }
</script>

<script>
    LS.get("G", "game");
    LS.get("G", "questions");
    LS.get("STATE", "answers");

    // uložení výsledků
    if(!G.demo) {
        var fd = new FormData();
        fd.set("answers", localStorage.getItem("STATE.answers")); // JSON encoded
        fd.set("user", LS.get("U", "login"));
        fd.set("url", G.game.url);
        API("storeAnswers", fd);
    }

    // vytvoř tabulková data
    var data = G.questions.map(q =>
        ({ questionName: q.name, score: STATE.answers[q.uniqid] || 0 })
    );
</script>

<h2>Tvoje skóre</h2>

<div style="margin-bottom: 20px;">
    <table class="score-table" id="scoreTable">
        <tr><th>Otázka</th><th>Počet bodů</th></tr>
        <!-- table content -->
        <tr style="border-top: 1px solid #ddd;"><th colspan="2">Bodů celkem</th></tr>
        <tr><td colspan="2" id="scoreSum"></td></tr>
    </table>
</div>
<script>
    // zobraz skóre
    var maxScore = data.length * 2;
    var sumScore = data.reduce((acc, val) => acc + val.score, 0);
    ID.scoreSum.innerText = `${ sumScore }/${ maxScore }`;

    // vytvoř obsah tabulky do virtuálního kontejneru
    var virtualContainer = document.createDocumentFragment();
    for(var piece of data) {
        virtualContainer.appendChild(
            ElemFromText(`<tr><td>${ piece.questionName }</td><td>${ piece.score }</td></tr>`)
        );
    }

    // vlož kontejner do tabulky
    var tBody = ID.scoreTable.tBodies[0];
    tBody.insertBefore(virtualContainer, tBody.children[1]);
</script>

<button type="button" onclick="setContent('homeUser')">Domů</button>

<script>
    // hráči byly zobrazeny výsledky, je odhlášen ze hry (pokud to není demo testování)
    if(!G.demo) LS.clear("G");
</script>
