<script>
    // vynucení připojení k internetu
    if(!navigator.onLine) {
        setContent("dialog", {
            title: "Výsledky",
            text: "Hra je u konce. Pro zobrazení výsledků se připoj k internetu a klikni na OK.",
            target: "playResults"
        });
        STATE.abort = true;
    }
</script>

<script>
    LS.get("G", "game");
    LS.get("STATE", "answers");

    // uložení výsledků
    if(!G.demo) {
        var fd = new FormData();
        fd.set("answers", localStorage.getItem("STATE.answers")); // JSON encoded
        fd.set("user", LS.get("U", "login"));
        fd.set("url", G.game.url);
        API("storeAnswers", fd);
    }
</script>

<script>
    var answers = STATE.answers;
    LS.get("G", "questions");
    var data = [];

    for(var key in answers) {

        var q = G.questions.find(i => i.uniqid === key);
        data.push({
            questionName: q.name, score: answers[key]
        });

    }

    var maxScore = data.length * 2;
    var sumScore = data.reduce((acc, val) => acc + val.score, 0);
    var sortedByScore = data.sort((a, b) => b.score - a.score);

    var dataTemp = [];

    sortedByScore.forEach((piece, i, a) => {

        if(i === 0) {
            dataTemp.push([
                piece.questionName, piece.score, `${ sumScore }/${ maxScore }`
            ]);
        } else {
            dataTemp.push([
                piece.questionName, piece.score
            ]);
        }


    });

    var tableTemp = {
        headers: ["Otázka", "Počet bodů", "Celkem bodů"],
        rowSpan: [1, 1, data.length],
        colSpan: [1, 1, 1],
        data: [...dataTemp]
    };


    async function sendScore() {
        await API("sendScore", JSON.stringify(answers));
        //setContent("homeGame");
    }
</script>

<h2>Tvoje skóre</h2>

<div id="resultTable" style="margin-bottom: 20px;"></div>
<script>
    id("resultTable");
    resultTable.appendChild(
        createScoreTable(tableTemp)
    );

    // hráči byly zobrazeny výsledky, je odhlášen ze hry (pokud to není demo testování)
    if(!G.demo) LS.clear("G");
</script>
