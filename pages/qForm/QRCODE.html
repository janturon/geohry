<script>
    /*
        MESSAGE: answer, questionUniqid
    */
</script>

<button type="button" id="qrStart">Načti QR kód</button>
<button type="button" id="qrStop" style="display: none">Vypni kameru</button>
<br><br>
<div id="qrReader" style="width: 100%; max-width: 500px"></div>
<p id="qrDialog">Pro splnění úkolu klikni na <b>Načti QR kód</b>, povol zadní kameru na mobilu a naskenuj QR kód.</p>
<button id="sendResult" style="display: none;" onclick="setContent('playQuestion', { status: message.status })">Odpověz</button>
<!-- odešle status (true pokud je qr kód správný, jinak false) přesměruje s touto zprávou na playQuestion) -->
<script>
    var qrCode;

    (async function () {
        var camId;
        var devices = await navigator.mediaDevices.enumerateDevices();
        for (var i = devices.length; i-- != 0;)
            if (devices[i].kind == "videoinput") {
                camId = devices[i].deviceId;
                break;
            }
        if (!camId) return;
        var qrClear = function () {
            qrCode.stop();
            ID.qrStart.style.display = "inline-block";
            ID.qrStop.style.display = "none";
        }
        var onScan = function (msg) {
            qrClear();
            if(questionUniqid == msg) {
                message.status = true;
            } else {
                message.status = false;
            }
            ID.sendResult.style.display = "block";
            ID.qrDialog.innerHTML = 'QR kód naskenován. Klikni na <b>Odpověz</b> pro odeslání.';
        }
        ID.qrStop.onclick = qrClear;
        var options = {
            fps: 10,
            qrbox: 250
        };
        ID.qrStart.onclick = function () {
            if (!qrCode) qrCode = new Html5Qrcode("qrReader");
            qrCode.start(camId, options, onScan, () => {});
            ID.qrStart.style.display = "none";
            ID.qrStop.style.display = "inline-block";
        }
    })();

</script>